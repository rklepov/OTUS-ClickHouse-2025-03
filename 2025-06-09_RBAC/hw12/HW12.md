# [12] Контроль доступа

```sql
SELECT
    version(),
    toDate(now('Europe/Moscow'))
FORMAT Raw

25.4.2.31       2025-06-17
```

[Creating Users and Roles in ClickHouse](https://clickhouse.com/docs/operations/access-rights).

## Создание пользователя: [`CREATE USER`](https://clickhouse.com/docs/sql-reference/statements/create/user)

```sql
CREATE USER john IDENTIFIED WITH plaintext_password BY 'qwerty'

Ok.

0 rows in set. Elapsed: 0.004 sec.
```

## Создание роли: [`CREATE ROLE`](https://clickhouse.com/docs/sql-reference/statements/create/role)

```sql
CREATE ROLE devs

Ok.

0 rows in set. Elapsed: 0.004 sec.
```

## Права для роли: [`GRANT`](https://clickhouse.com/docs/sql-reference/statements/grant)

```sql
GRANT SELECT ON *.* TO devs

Ok.

0 rows in set. Elapsed: 0.004 sec.
```

## Присвоение роли пользователю: [`GRANT`](https://clickhouse.com/docs/sql-reference/statements/grant)

```sql
GRANT devs TO john

Ok.

0 rows in set. Elapsed: 0.004 sec.
```

## Запросы из *system*-таблиц

Запросы будем делать под новосозданным пользователем *john* (а иначе зачем мы его создавали?).

```shell
root@3e16fa9ca9d8:/# clickhouse-client --user john

ClickHouse client version 25.4.2.31 (official build).
Connecting to localhost:9000 as user john.
Password for user (john):
Connecting to localhost:9000 as user john.
Connected to ClickHouse server version 25.4.2.
```

### [`system.users`](https://clickhouse.com/docs/operations/system-tables/users)

```sql
SELECT *
FROM system.users
WHERE name = 'john' \G

Row 1:
──────
name:                 john
id:                   f14bd7f1-caf4-c542-45d6-e4a17b562f90
storage:              local_directory
auth_type:            ['plaintext_password']
auth_params:          ['{}']
host_ip:              ['::/0']
host_names:           []
host_names_regexp:    []
host_names_like:      []
default_roles_all:    1
default_roles_list:   []
default_roles_except: []
grantees_any:         1
grantees_list:        []
grantees_except:      []
default_database:

1 row in set. Elapsed: 0.005 sec.
```

### [`system.roles`](https://clickhouse.com/docs/operations/system-tables/roles)

```sql
SELECT *
FROM system.roles

   ┌─name─┬─id───────────────────────────────────┬─storage─────────┐
1. │ devs │ 2d4ed134-a54e-d3c3-f842-ca58fa1c599c │ local_directory │
   └──────┴──────────────────────────────────────┴─────────────────┘

1 row in set. Elapsed: 0.003 sec.
```

### [`system.role_grants`](https://clickhouse.com/docs/operations/system-tables/role-grants)

```sql
SELECT *
FROM system.role_grants

   ┌─user_name─┬─role_name─┬─granted_role_name─┬─granted_role_id──────────────────────┬─granted_role_is_default─┬─with_admin_option─┐
1. │ john      │ ᴺᵁᴸᴸ      │ devs              │ 2d4ed134-a54e-d3c3-f842-ca58fa1c599c │                       1 │                 0 │
   └───────────┴───────────┴───────────────────┴──────────────────────────────────────┴─────────────────────────┴───────────────────┘

1 row in set. Elapsed: 0.004 sec.
```

### [`system.grants`](https://clickhouse.com/docs/operations/system-tables/grants)

```sql
SELECT *
FROM system.grants
WHERE role_name IN ('devs')

   ┌─user_name─┬─role_name─┬─access_type─┬─database─┬─table─┬─column─┬─is_partial_revoke─┬─grant_option─┐
1. │ ᴺᵁᴸᴸ      │ devs      │ SELECT      │ ᴺᵁᴸᴸ     │ ᴺᵁᴸᴸ  │ ᴺᵁᴸᴸ   │                 0 │            0 │
   └───────────┴───────────┴─────────────┴──────────┴───────┴────────┴───────────────────┴──────────────┘

1 row in set. Elapsed: 0.005 sec.
```
